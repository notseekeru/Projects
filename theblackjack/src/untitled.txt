#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <cstdlib>
#include <ctime>
#include <string.h>

#define BUTTON_PIN_4 4
#define BUTTON_PIN_18 18
Adafruit_SSD1306 display(128, 64, &Wire, -1);


// FUNCTIONS
void displayStartMenu() {
    display.clearDisplay();
    display.setTextSize(1);
    display.setTextColor(SSD1306_WHITE);
    display.setCursor(,2);
    display.println("===== START ====");
    display.setCursor(0,32);
    display.println("Play?");
    display.setCursor(0,54);
    display.println("<--- YES | NO --->");
    display.display();
}

void displayHitOrStandMenu() {
    display.clearDisplay();
    display.setTextColor(SSD1306_WHITE);
    display.setCursor(0,10);
    display.println("HIT OR STAND");
    display.setCursor(0, 20);
    display.println("<--- || --->");
    display.display();
}
// SIMPLE TEXT
int displaySimpleText(const char* x, const char* y , const char* z, int a, int b, int c) {
    display.clearDisplay();
    display.setCursor(0, 0);
    display.display();

    delay(a);
    display.println(x);
    display.display();
    delay(b);
    display.println(y);
    display.display();
    delay(c);
    display.println(z);
    display.display();
    delay(200);
    return 0;
}

// BUTTON LOGIC
int LastState_A = HIGH;
int CurrentState_A;
int LastState_B = HIGH;
int CurrentState_B;
int result;

// Returns: 1 if BUTTON_PIN_4 pressed, 0 if BUTTON_PIN_18 pressed, -1 if no press
int waitForButton() {
    CurrentState_A = digitalRead(BUTTON_PIN_4);
    CurrentState_B = digitalRead(BUTTON_PIN_18);

    result = -1;

    if (LastState_A == HIGH && CurrentState_A == LOW) {
        result = 1;
    }
    else if (LastState_B == HIGH && CurrentState_B == LOW) {
        result = 0;
    }

    LastState_A = CurrentState_A;
    LastState_B = CurrentState_B;

    return result;
}
int waitForButton2() {
    CurrentState_A = digitalRead(BUTTON_PIN_4);
    CurrentState_B = digitalRead(BUTTON_PIN_18);

    result = -1;

    if (LastState_A == HIGH && CurrentState_A == LOW) {
        result = 1;
    }
    else if (LastState_B == HIGH && CurrentState_B == LOW) {
        result = 0;
    }

    LastState_A = CurrentState_A;
    LastState_B = CurrentState_B;

    return result;
}

// ACTUAL LOGIC OF THE ESP32

uint32_t seed = 0;
void setup() {
    Serial.begin(115200);

    pinMode(BUTTON_PIN_4, INPUT_PULLUP);
    pinMode(BUTTON_PIN_18, INPUT_PULLUP);

    if(!display.begin(SSD1306_SWITCHCAPVCC, 0x3C)) { 
    Serial.println(F("SSD1306 allocation failed"));
    for(;;);
    }

    displayStartMenu();
}

void loop() {
    int ans = waitForButton();
    if (ans == 1) {
        Serial.println("BTN 1 - ON");
        displaySimpleText("3..", "2...", "1...", 500,500,250);
        displayHitOrStandMenu();
        int ans2 = waitForButton2();
        if (ans2 == 1) {
            Serial.println("you press hit");
        }
    }
    if (ans == 0) {
        Serial.println("BTN 2 - ON");
        displaySimpleText("KYS", "IN GAME", "OFCOURSE:)", 1000, 1500, 1750);
    }
}
